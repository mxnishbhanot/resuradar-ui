<div class="builder-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar-rail">

    <div class="brand-area">
      <div class="brand-logo"><mat-icon>description</mat-icon></div>
      <div class="brand-info">
        <h1>ResuRadar</h1>

        <div class="progress-pill">
          <div class="progress-text">
            <span>Progress</span>
            <span class="percent">{{ completionPercentage() }}%</span>
          </div>

          <mat-progress-bar mode="determinate" [value]="completionPercentage()">
          </mat-progress-bar>
        </div>
      </div>
    </div>

    <nav class="nav-menu">
      <button *ngFor="let tab of tabs; let i = index"
        class="nav-item-premium"
        [class.active]="currentTab() === i"
        [class.completed]="isTabCompleted(i)"
        (click)="navigateToTab(i)"
        (mouseenter)="prefetchTab(i)">

        <div class="nav-bg-layer"></div>

        <div class="nav-content">

          <div class="icon-stage">
            <mat-icon class="base-icon">{{ tab.icon }}</mat-icon>

            <mat-icon *ngIf="isTabCompleted(i)" class="check-icon">check_circle</mat-icon>
          </div>

          <span class="nav-label">{{ tab.label }}</span>
          <mat-icon class="hover-arrow">chevron_right</mat-icon>

          <div *ngIf="currentTab() === i" class="active-bar"></div>
        </div>
      </button>
    </nav>
  </aside>

  <!-- MAIN STAGE -->
  <main class="main-stage">
    <div class="content-wrapper">

      <div class="form-container">

        <!-- dynamic step loader -->
        <ng-container *ngIf="currentStepComponent() as Step">
          <ng-container *ngComponentOutlet="Step"></ng-container>
        </ng-container>

        <!-- fallback skeleton while component loads -->
        <ng-template #skeleton>
          <div class="builder-skeleton">Loading stepâ€¦</div>
        </ng-template>

      </div>

    </div>

    <!-- MOBILE COMMAND BAR -->
    <div class="mobile-command-deck">

      <div class="deck-progress-track">
        <div class="deck-progress-fill" [style.width.%]="((currentTab() + 1) / tabs.length) * 100">
        </div>
      </div>

      <div class="deck-content">

        <button mat-icon-button class="deck-btn-ghost" [disabled]="currentTab() === 0" (click)="previousStep()">
          <mat-icon>arrow_back</mat-icon>
        </button>

        <div class="deck-info" (click)="scrollToTop()">
          <span class="step-label">Step {{ currentTab() + 1 }}</span>
          <span class="step-title">
            {{ tabs[currentTab()].label }}
          </span>
        </div>

        <button *ngIf="currentTab() < tabs.length - 1" mat-button class="deck-btn-primary" (click)="nextStep()">
          Next <mat-icon>arrow_forward</mat-icon>
        </button>

        <button *ngIf="currentTab() === tabs.length - 1"
          [disabled]="completionPercentage() != 100"
          mat-button
          class="deck-btn-primary finish"
          (click)="markCompleted()">
          Finish <mat-icon>stars</mat-icon>
        </button>

      </div>

    </div>
  </main>

  <!-- ACTION RAIL -->
  <aside class="action-rail">

    <div class="preview-card">
      <div class="card-visual">
        <mat-icon>desktop_windows</mat-icon>
        <div class="visual-ring"></div>
      </div>
      <h3>Live Preview</h3>
      <p>Visualize your resume as you build.</p>

      <button mat-stroked-button class="btn-premium btn-ghost" (click)="openPreview()">
        <span>Open Canvas</span>
        <mat-icon>open_in_new</mat-icon>
      </button>
    </div>

    <!-- BOTTOM ACTIONS -->
    <div class="action-buttons-container">

      <div class="nav-row">

        <!-- BACK -->
        <button mat-button class="btn-premium btn-ghost" [disabled]="currentTab() === 0" (click)="previousStep()">
          <mat-icon>arrow_back</mat-icon>
          Back
        </button>

        <!-- NEXT / FINISH -->
        <button *ngIf="currentTab() < tabs.length - 1" mat-flat-button class="btn-premium btn-primary" (click)="nextStep()">
          Next Step <mat-icon>arrow_forward</mat-icon>
        </button>

        <button *ngIf="currentTab() === tabs.length - 1"
          [disabled]="completionPercentage() != 100"
          mat-flat-button
          class="btn-premium btn-finish"
          (click)="markCompleted()">
          Finish <mat-icon>stars</mat-icon>
        </button>

      </div>

    </div>
  </aside>

</div>


