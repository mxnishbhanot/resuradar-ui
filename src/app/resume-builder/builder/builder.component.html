<div class="builder-layout">

  <aside class="sidebar-rail">
    <div class="brand-area">
      <div class="brand-logo">
        <mat-icon>description</mat-icon>
      </div>
      <div class="brand-info">
        <h1>ResuRadar</h1>
        <div class="progress-pill">
          <div class="progress-text">
            <span>Progress</span>
            <span class="percent">{{ completionPercentage() }}%</span>
          </div>
          <mat-progress-bar mode="determinate" [value]="completionPercentage()"></mat-progress-bar>
        </div>
      </div>
    </div>

    <nav class="nav-menu">
      @for (tab of tabs; track tab.label; let i = $index) {
        <button class="nav-item-premium"
                [class.active]="currentTab() === i"
                [class.completed]="isTabCompleted(i)"
                (click)="navigateToTab(i)">

          <div class="nav-bg-layer"></div>

          <div class="nav-content">
            <div class="icon-stage">
              <mat-icon class="base-icon">{{ tab.icon }}</mat-icon>
              <!-- @if (isTabCompleted(i)) {
                <mat-icon class="check-icon">check_circle</mat-icon>
              } -->
            </div>

            <span class="nav-label">{{ tab.label }}</span>
            <mat-icon class="hover-arrow">chevron_right</mat-icon>

            @if (currentTab() === i) {
               <div class="active-bar" layout:view-transition-name="active-bar"></div>
            }
          </div>
        </button>
      }
    </nav>
  </aside>

  <main class="main-stage">
    <div class="content-wrapper">

      <div class="form-container">
        @switch (currentTab()) {
          @case (0) { <rr-personal class="fade-in-up"/> }
          @case (1) { <rr-education class="fade-in-up"/> }
          @case (2) { <rr-experience class="fade-in-up"/> }
          @case (3) { <rr-projects class="fade-in-up"/> }
          @case (4) { <rr-skills class="fade-in-up"/> }
          @case (5) { <rr-summary class="fade-in-up"/> }
        }
      </div>
    </div>

    <div class="mobile-command-deck">
      <div class="deck-progress-track">
        <div class="deck-progress-fill"
             [style.width.%]="((currentTab() + 1) / tabs.length) * 100">
        </div>
      </div>

      <div class="deck-content">
        <button mat-icon-button
                class="deck-btn-ghost"
                [disabled]="currentTab() === 0"
                (click)="previousStep()">
          <mat-icon>arrow_back</mat-icon>
        </button>

        <div class="deck-info" (click)="scrollToTop()">
          <span class="step-label">Step {{ currentTab() + 1 }}</span>
          <span class="step-title" layout:view-transition-name="mobile-title">
            {{ tabs[currentTab()].label }}
          </span>
        </div>

        @if (currentTab() === tabs.length - 1) {
          <button mat-button class="deck-btn-primary finish" (click)="openPreview()">
            <span>Finish</span>
            <mat-icon>stars</mat-icon>
          </button>
        } @else {
          <button mat-button class="deck-btn-primary" (click)="nextStep()">
            <span>Next</span>
            <mat-icon>arrow_forward</mat-icon>
          </button>
        }
      </div>
    </div>
  </main>

  <aside class="action-rail">
    <!-- New Checklist Section - Only visible on desktop -->

    <div class="preview-card">
      <div class="card-visual">
        <mat-icon>desktop_windows</mat-icon>
        <div class="visual-ring"></div>
      </div>
      <h3>Live Preview</h3>
      <p>Visualize your resume as you build.</p>
      <button mat-stroked-button class="btn-premium btn-ghost" (click)="openPreview()">
        <div class="btn-content">
          <span>Open Canvas</span>
          <mat-icon>open_in_new</mat-icon>
        </div>
      </button>
    </div>

    <div class="checklist-section">
      <div class="checklist-header">
        <mat-icon class="checklist-icon">fact_check</mat-icon>
        <h4 class="checklist-title">Completion Checklist</h4>
      </div>
      <div class="checklist-items">
        <div class="checklist-item" [class.completed]="isTabCompleted(0)">
          <div class="checklist-icon-wrapper">
            <mat-icon>{{ isTabCompleted(0) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="checklist-content">
            <span class="checklist-label">Personal Information</span>
            <span class="checklist-description">Name and contact details added</span>
          </div>
        </div>
        <div class="checklist-item" [class.completed]="isTabCompleted(5)">
          <div class="checklist-icon-wrapper">
            <mat-icon>{{ isTabCompleted(5) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="checklist-content">
            <span class="checklist-label">Professional Summary</span>
            <span class="checklist-description">Compelling overview created</span>
          </div>
        </div>
        <div class="checklist-item" [class.completed]="isTabCompleted(2)">
          <div class="checklist-icon-wrapper">
            <mat-icon>{{ isTabCompleted(2) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="checklist-content">
            <span class="checklist-label">Work Experience</span>
            <span class="checklist-description">At least one position added</span>
          </div>
        </div>
        <div class="checklist-item" [class.completed]="isTabCompleted(1)">
          <div class="checklist-icon-wrapper">
            <mat-icon>{{ isTabCompleted(1) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="checklist-content">
            <span class="checklist-label">Education</span>
            <span class="checklist-description">Academic background included</span>
          </div>
        </div>
        <div class="checklist-item" [class.completed]="isTabCompleted(3)">
          <div class="checklist-icon-wrapper">
            <mat-icon>{{ isTabCompleted(3) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="checklist-content">
            <span class="checklist-label">Projects</span>
            <span class="checklist-description">At least one project added</span>
          </div>
        </div>
        <div class="checklist-item" [class.completed]="isTabCompleted(4)">
          <div class="checklist-icon-wrapper">
            <mat-icon>{{ isTabCompleted(4) ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="checklist-content">
            <span class="checklist-label">Skills</span>
            <span class="checklist-description">At least 3 skills listed</span>
          </div>
        </div>
      </div>
      <!-- Completion Message -->
      @if (completionPercentage() === 100) {
        <div class="completion-message">
          <div class="completion-icon">
            <mat-icon>celebration</mat-icon>
          </div>
          <div class="completion-text">
            <h5 class="completion-title">ðŸŽ‰ Resume Complete!</h5>
            <p class="completion-description">Great job! Your resume is ready. Click "Finish" to review and download.</p>
          </div>
        </div>
      }
    </div>

    <div class="action-buttons-container">
      <div class="nav-row">
        <button mat-button
                class="btn-premium btn-ghost"
                [disabled]="currentTab() === 0"
                (click)="previousStep()">
          <div class="btn-content">
            <mat-icon class="icon-slide-left">arrow_back</mat-icon>
            <span>Back</span>
          </div>
        </button>

        @if (currentTab() < tabs.length - 1) {
          <button mat-flat-button
                  class="btn-premium btn-primary"
                  (click)="nextStep()">
            <div class="btn-content">
              <span>Next Step</span>
              <mat-icon class="icon-slide-right">arrow_forward</mat-icon>
            </div>
          </button>
        } @else {
          <button mat-flat-button
                  class="btn-premium btn-finish"
                  (click)="openPreview()">
            <div class="btn-content">
              <span>Finish</span>
              <mat-icon class="icon-bounce">stars</mat-icon>
            </div>
          </button>
        }
      </div>
    </div>
  </aside>
</div>
