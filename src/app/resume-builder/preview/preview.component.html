<div class="preview-container">

  <div class="preview-header">
    <div class="header-left">
      <button mat-icon-button class="close-btn" (click)="close()" matTooltip="Close">
        <mat-icon>close</mat-icon>
      </button>

      <div class="template-selector">
        <label for="templateSelect">Template:</label>
        <select
          id="templateSelect"
          class="template-dropdown"
          [ngModel]="currentTemplate()"
          (ngModelChange)="currentTemplate.set($event)"
        >
          @for (t of templates(); track t.value) {
            <option [value]="t.value">{{ t.label }}</option>
          }
        </select>
      </div>
    </div>

    @if (!isLoading() && !showEmptyState()) {
      <div class="zoom-controls">
        <button mat-icon-button (click)="zoomOut()" matTooltip="Zoom Out"><mat-icon>zoom_out</mat-icon></button>
        <span class="zoom-value">{{ zoomPercent() }}</span>
        <button mat-icon-button (click)="zoomIn()" matTooltip="Zoom In"><mat-icon>zoom_in</mat-icon></button>
        <button mat-icon-button (click)="resetZoom()" matTooltip="Reset Zoom"><mat-icon>refresh</mat-icon></button>
      </div>
    }

    <button
      mat-flat-button color="primary"
      (click)="downloadPDF()"
      [disabled]="isLoading() || showEmptyState()"
      class="download-btn"
    >
      <mat-icon>download</mat-icon>
      <span>{{ isLoading() ? 'Generating...' : 'Download PDF' }}</span>
    </button>
  </div>

  <div class="preview-body">

    @if (isLoading()) {
      <div class="skeleton"><div class="skeleton-page"></div></div>
    }

    @else if (showEmptyState()) {
      <div class="empty-state-message">
        <mat-card class="empty-state-card">
          <mat-icon class="empty-state-icon">description</mat-icon>
          <h3>Your Resume is Empty</h3>
          <p>Add details to your resume to generate a preview.</p>
          <button mat-raised-button color="primary" (click)="close()">Go Back to Builder</button>
        </mat-card>
      </div>
    }

    @else if (pdfUrl()) {
      <div class="preview-frame-wrapper">
        <pdf-viewer
          [src]="pdfUrl()!"
          [zoom]="zoom()"
          [original-size]="false"
          [render-text]="true"
          [show-all]="true"
          (after-load-complete)="onPDFLoaded()"
          style="display: block; width: 100%; height: 100%;"
        ></pdf-viewer>
      </div>
    }
  </div>
</div>
