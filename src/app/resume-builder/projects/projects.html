<div class="projects-container">

  <div class="section-header">
    <div class="header-icon-wrapper">
      <mat-icon class="header-icon">code</mat-icon>
    </div>
    <div class="header-content">
      <h2 class="section-title">Personal Projects</h2>
      <p class="section-subtitle">Showcase personal, freelance, or open-source projects. Focus on technologies used and impact.</p>
    </div>
  </div>

  <div class="projects-list" *ngIf="projects.length > 0 && !showForm">
    <div *ngFor="let project of projects; let i = index" class="project-card">
      <div class="card-header">
        <div class="card-badge">
          <mat-icon>terminal</mat-icon>
        </div>
        <div class="card-title-section">
          <h3 class="card-title">{{ project.title }}</h3>
          <p class="card-role">
            <mat-icon class="inline-icon">person</mat-icon>
            {{ project.role || 'Developer' }}
          </p>
        </div>
        <div class="card-actions">
          <button mat-icon-button (click)="editProject(i)" class="action-btn edit-btn" matTooltip="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteProject(i)" class="action-btn delete-btn" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <div class="card-meta">
        <div class="meta-item">
          <mat-icon class="meta-icon">calendar_today</mat-icon>
          <span>{{ project.startDate }} - {{ project.isCurrent ? 'Ongoing' : project.endDate }}</span>
        </div>
        <div class="meta-badge" *ngIf="project.isCurrent">
          <mat-icon>update</mat-icon>
          <span>Active</span>
        </div>
      </div>

      <div class="card-tech-stack" *ngIf="project.techStack && project.techStack.length > 0">
        <p class="tech-label">Key Technologies:</p>
        <mat-chip-set role="list" class="read-only-chip-set">
          <mat-chip *ngFor="let tech of project.techStack" role="listitem" class="tech-chip">
            {{ tech }}
          </mat-chip>
        </mat-chip-set>
      </div>

      <div class="card-bullets" *ngIf="project.bullets && project.bullets.length > 0">
        <ul class="bullets-list">
          <li *ngFor="let bullet of project.bullets" class="bullet-item">
            <mat-icon class="bullet-icon">check_circle</mat-icon>
            <span>{{ bullet }}</span>
          </li>
        </ul>
      </div>

    </div>
  </div>

  <div class="empty-state" *ngIf="projects.length === 0 && !showForm">
    <div class="empty-state-icon">
      <mat-icon>construction</mat-icon>
    </div>
    <h3 class="empty-state-title">No Projects Added Yet</h3>
    <p class="empty-state-description">Add side projects, hackathons, or open-source contributions. Highlight the scale and the results.</p>
    <button mat-flat-button color="primary" class="empty-state-button" (click)="showAddForm()">
      <mat-icon>add_circle</mat-icon>
      Add Your First Project
    </button>
  </div>

  <button mat-stroked-button class="add-more-button" *ngIf="projects.length > 0 && !showForm" (click)="showAddForm()">
    <mat-icon>add</mat-icon>
    Add Another Project
  </button>

  <div class="form-container" *ngIf="showForm">
    <div class="form-header">
      <div class="form-header-icon">
        <mat-icon>{{ editingIndex !== null ? 'edit' : 'add_circle' }}</mat-icon>
      </div>
      <div class="form-header-text">
        <h3 class="form-title">{{ editingIndex !== null ? 'Edit Project' : 'Add New Project' }}</h3>
        <p class="form-subtitle">{{ editingIndex !== null ? 'Update your project details' : 'Tell us about your technical creation' }}</p>
      </div>
    </div>

    <form [formGroup]="form" class="projects-form">

      <div class="form-section">
        <h4 class="form-section-title">
          <mat-icon>info</mat-icon>
          Project Details
        </h4>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Project Title</mat-label>
            <input matInput formControlName="title" placeholder="e.g., Resume Builder SaaS" />
            <mat-icon matPrefix>apartment</mat-icon>
            <mat-error *ngIf="form.get('title')?.hasError('required')">Project title is required</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row form-row-two">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Your Role</mat-label>
            <input matInput formControlName="role" placeholder="e.g., Lead Developer" />
            <mat-icon matPrefix>person</mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Project Link (Optional)</mat-label>
            <input matInput formControlName="link" placeholder="https://github.com/project-name" />
            <mat-icon matPrefix>link</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <div class="form-section">
        <h4 class="form-section-title">
          <mat-icon>schedule</mat-icon>
          Timeline
        </h4>

        <div class="form-row form-row-two">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Start Date</mat-label>
            <input matInput formControlName="startDate" placeholder="e.g., Sep 2023" />
            <mat-icon matPrefix>event_available</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field" [class.disabled-field]="form.get('isCurrent')?.value">
            <mat-label>End Date</mat-label>
            <input matInput formControlName="endDate" placeholder="e.g., Dec 2023" [disabled]="form.get('isCurrent')?.value" />
            <mat-icon matPrefix>event_busy</mat-icon>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-checkbox formControlName="isCurrent" class="current-checkbox" color="primary">
            <span class="checkbox-label">
              This project is still ongoing / maintained
            </span>
          </mat-checkbox>
        </div>
      </div>

      <div class="form-section chips-input-section">
        <div class="section-header-simple">
           <h4 class="form-section-title">
            <mat-icon>apps</mat-icon>
            Tech Stack Used
          </h4>
        </div>

        <p class="chips-hint">
          <mat-icon class="hint-icon">lightbulb</mat-icon>
          List the key frameworks and languages (e.g., Angular, Node.js, TypeScript).
        </p>

        <mat-form-field appearance="outline" class="form-field full-width chip-form-field">
          <mat-label>Add Technology...</mat-label>
          <mat-chip-grid #chipGrid aria-label="Enter technologies">
            <mat-chip-row *ngFor="let techCtrl of techStackControls; let i = index"
                          (removed)="removeTech(i)">
              {{techCtrl.value}}
              <button matChipRemove [attr.aria-label]="'remove ' + techCtrl.value">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
            <input placeholder="New Technology..."
                   [matChipInputFor]="chipGrid"
                   [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                   (matChipInputTokenEnd)="addTech($event)"/>
          </mat-chip-grid>
           <mat-icon matPrefix>build</mat-icon>
        </mat-form-field>
      </div>

      <div class="form-section bullets-section">
        <div class="bullets-section-header">
          <h4 class="form-section-title">
            <mat-icon>stars</mat-icon>
            Key Contributions & Results
          </h4>
        </div>

        <p class="bullets-hint">
          <mat-icon class="hint-icon">lightbulb</mat-icon>
          Describe features implemented or technical challenges solved.
        </p>

        <div formArrayName="bullets" class="bullets-container">
          <div *ngFor="let bullet of bullets.controls; let i = index" class="bullet-row">
            <div class="bullet-number-badge">{{ i + 1 }}</div>
            <mat-form-field appearance="outline" class="bullet-field">
              <mat-label>Contribution/Feature {{ i + 1 }}</mat-label>
              <textarea matInput [formControlName]="i" rows="3"
                        placeholder="Describe your contribution or feature..."
                        cdkTextareaAutosize
                        cdkAutosizeMinRows="2"
                        cdkAutosizeMaxRows="5"></textarea>
            </mat-form-field>
            <button mat-icon-button type="button" (click)="removeBullet(i)" class="bullet-delete-btn" matTooltip="Remove">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          <button mat-stroked-button type="button" (click)="addBullet()" class="add-bullet-btn">
            <mat-icon>add</mat-icon>
            Add Another Point
          </button>
        </div>
      </div>

      <div class="form-actions">
        <button mat-stroked-button type="button" (click)="cancelForm()" class="cancel-btn">
          <mat-icon>close</mat-icon>
          Cancel
        </button>
        <button mat-flat-button color="primary" (click)="saveProject()" [disabled]="form.invalid" class="save-btn">
          <mat-icon>{{ editingIndex !== null ? 'check' : 'add' }}</mat-icon>
          {{ editingIndex !== null ? 'Update Project' : 'Add Project' }}
        </button>
      </div>
    </form>
  </div>

</div>
