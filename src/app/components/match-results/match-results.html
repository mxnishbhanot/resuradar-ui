<div class="match-container">

  @if (data()) {

  <!-- Background -->
  <div class="background-gradient"></div>

  <!-- HEADER -->
  <div class="match-header">
    <div class="header-content">

      <div class="title-section">
        <div class="header-badge">
          <mat-icon>auto_awesome</mat-icon>
          <span>AI-Powered Matching</span>
        </div>
        <h1 class="main-title">Job Match Analysis</h1>
        <p class="subtitle">
          AI-powered alignment report between your resume and the job description
        </p>
      </div>

      <!-- Score Section -->
      <div class="score-section">
        <div class="score-display" [ngClass]="getScoreClass()">

          <div class="score-circle">
            <svg class="score-progress" viewBox="0 0 120 120">
              <circle class="progress-bg" cx="60" cy="60" r="54" />
              <circle class="progress-bar" cx="60" cy="60" r="54" [attr.stroke-dasharray]="circumference"
                [attr.stroke-dashoffset]="strokeDashoffset()" />
            </svg>

            <div class="score-content">
              <span class="score-value">{{ data().free_feedback.match_score }}</span>
              <span class="score-out-of">/100</span>
            </div>
          </div>

          <div class="score-label">{{ data().free_feedback.match_level }}</div>
          <div class="score-description">{{ getScoreDescription() }}</div>
        </div>
      </div>

    </div>
  </div>

  <!-- CONTENT GRID -->
  <div class="content-grid">

    <!-- LEFT COLUMN -->
    <div class="left-column">

      <!-- SUMMARY -->
      <mat-card class="summary-card">
        <div class="card-header">
          <div class="icon-container">
            <mat-icon class="header-icon">summarize</mat-icon>
          </div>
          <h2>Match Summary</h2>
        </div>

        <mat-divider></mat-divider>

        <div class="card-content">
          <p class="summary-text">{{ data().free_feedback.summary }}</p>
        </div>
      </mat-card>

      <!-- STRENGTHS -->
      <mat-card class="insight-card strength-card">
        <div class="card-header">
          <div class="icon-container success">
            <mat-icon>thumb_up</mat-icon>
          </div>
          <h3>Strengths</h3>
        </div>

        <div class="card-content">
          <ul class="insight-list">
            @for (strength of data().free_feedback.strengths; track strength) {
            <li class="insight-item">
              <mat-icon class="item-icon success">check_circle</mat-icon>
              <span>{{ strength }}</span>
            </li>
            }
          </ul>
        </div>
      </mat-card>

      <!-- GAPS -->
      <mat-card class="insight-card gap-card">
        <div class="card-header">
          <div class="icon-container warning">
            <mat-icon>lightbulb</mat-icon>
          </div>
          <h3>Improvement Areas</h3>
        </div>

        <div class="card-content">
          <ul class="insight-list">
            @for (gap of data().free_feedback.gaps; track gap) {
            <li class="insight-item">
              <mat-icon class="item-icon warning">info</mat-icon>
              <span>{{ gap }}</span>
            </li>
            }
          </ul>
        </div>
      </mat-card>

    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-column">

      <!-- LOCKED VIEW -->
      @if (!isProUser()) {
      <mat-card class="premium-lock-card">
        <div class="lock-content">
          <div class="lock-icon-container">
            <mat-icon class="lock-icon">lock</mat-icon>
          </div>

          <h3>Unlock Full Match Insights</h3>
          <p class="lock-subtitle">
            Get keyword analysis, role-fit breakdown, rewrite suggestions, and more.
          </p>

          <button mat-flat-button class="upgrade-btn" (click)="openUpgradeModal()">
            <mat-icon>rocket_launch</mat-icon>
            Upgrade to Pro
          </button>
        </div>
      </mat-card>
      }

      <!-- PREMIUM CONTENT -->
      @if (isProUser()) {

      <!-- Keyword Match -->
      <mat-card class="premium-card">
        <div class="card-header">
          <div class="icon-container"><mat-icon class="header-icon">tag</mat-icon></div>
          <h3>Keyword Match</h3>
        </div>

        <mat-divider></mat-divider>

        <div class="card-content">
          <p>
            <strong>
              {{ data().premium_feedback.keyword_analysis.matched_keywords }} /
              {{ data().premium_feedback.keyword_analysis.total_keywords_in_jd }}
            </strong>
            keywords matched
          </p>

          @if (data().premium_feedback.keyword_analysis.missing_keywords.length > 0) {
          <div class="missing-keywords">
            <strong>Missing:</strong>
            {{ data().premium_feedback.keyword_analysis.missing_keywords.join(', ') }}
          </div>
          }
        </div>
      </mat-card>

      <!-- Role Fit Breakdown -->
      <mat-card class="premium-card">
        <div class="card-header">
          <div class="icon-container"><mat-icon class="header-icon">analytics</mat-icon></div>
          <h3>Role Fit Breakdown</h3>
        </div>

        <mat-divider></mat-divider>

        <div class="card-content">

          @for (key of ['technical_skills_fit','experience_fit','education_fit','soft_skills_fit']; track key) {

          <div class="fit-item">
            <span>{{ key.replace('_',' ') | titlecase }}</span>
            <span class="fit-value">
              {{ data().premium_feedback.role_fit_breakdown[key] }}%
            </span>
          </div>

          <mat-progress-bar mode="determinate" color="primary" class="fit-bar"
            [value]="data().premium_feedback.role_fit_breakdown[key]">
          </mat-progress-bar>
          }

        </div>
      </mat-card>

      <!-- Recommendations -->
      <mat-card class="premium-card">
        <div class="card-header">
          <div class="icon-container"><mat-icon class="header-icon">lightbulb</mat-icon></div>
          <h3>Actionable Recommendations</h3>
        </div>

        <mat-divider></mat-divider>

        <div class="card-content">
          <ul class="tips-list">
            @for (rec of data().premium_feedback.recommendations; track rec) {
            <li class="tip-item">
              <mat-icon class="tip-icon">arrow_right</mat-icon>
              <span>{{ rec }}</span>
            </li>
            }
          </ul>
        </div>
      </mat-card>

      <!-- Suggested Rewrites -->
      <mat-card class="premium-card">
        <div class="card-header">
          <div class="icon-container"><mat-icon class="header-icon">auto_fix_high</mat-icon></div>
          <h3>Rewritten Examples</h3>
        </div>

        <mat-divider></mat-divider>

        <div class="card-content">
          <div class="rewrites-list">

            @for (rw of data().premium_feedback.suggested_rewrites; track rw.original) {
            <div class="rewrite-item">
              <p class="original-text"><strong>Before:</strong> {{ rw.original }}</p>
              <p class="rewrite-text"><strong>After:</strong> {{ rw.suggestion }}</p>
            </div>
            }

          </div>
        </div>
      </mat-card>

      <!-- Success Banner -->
      <mat-card class="success-banner">
        <div class="banner-content">
          <mat-icon class="celebration-icon">celebration</mat-icon>
          <div class="banner-text">
            <h3>You're All Set!</h3>
            <p>Apply these insights to enhance your career opportunities</p>
          </div>
        </div>
      </mat-card>

      }
    </div>
  </div>
  }

</div>
